{% extends "document.njk" %}

{% block content %}
  {% if error %}
    {{ prose({ text: error.message }) }}
  {% else %}
    {% if featured and featured.length > 0 %}
    <h2>{{ __("github.featured.title") }}</h2>
    <div class="github-featured">
      {% for repo in featured %}
      <div class="github-featured__repo">
        <h3 class="github-featured__name">
          <a href="{{ repo.url }}" target="_blank" rel="noopener">{{ repo.fullName }}</a>
          {% if repo.isPrivate %}
          {{ badge({ color: "gray", text: "Private" }) }}
          {% endif %}
        </h3>
        {% if repo.description %}
        <p class="github-featured__desc">{{ repo.description }}</p>
        {% endif %}
        <div class="github-featured__meta">
          {% if repo.language %}
          <span class="github-lang">{{ repo.language }}</span>
          {% endif %}
          <span>★ {{ repo.stars }}</span>
          {% if repo.forks > 0 %}
          <span>⑂ {{ repo.forks }}</span>
          {% endif %}
        </div>
        {% if repo.commits and repo.commits.length > 0 %}
        <details class="github-featured__commits">
          <summary>Recent commits ({{ repo.commits.length }})</summary>
          <ul class="github-commit-list">
            {% for commit in repo.commits %}
            <li>
              <code><a href="{{ commit.url }}" target="_blank" rel="noopener">{{ commit.sha }}</a></code>
              <span>{{ commit.message }}</span>
              <small>by {{ commit.author }}</small>
            </li>
            {% endfor %}
          </ul>
        </details>
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if user %}
    <div class="github-profile">
      <img src="{{ user.avatar_url }}" alt="{{ user.login }}" class="github-profile__avatar" width="64" height="64">
      <div class="github-profile__info">
        <strong>{{ user.name or user.login }}</strong>
        {% if user.bio %}
        <p>{{ user.bio }}</p>
        {% endif %}
        <a href="{{ user.html_url }}" class="github-profile__link" target="_blank" rel="noopener">@{{ user.login }}</a>
      </div>
    </div>
    {% endif %}

    <h2>{{ __("github.commits.title") }}</h2>
    {% if commits and commits.length > 0 %}
    <ul class="github-list">
      {% for commit in commits %}
      <li class="github-list__item">
        <code class="github-sha"><a href="{{ commit.url }}" target="_blank" rel="noopener">{{ commit.sha }}</a></code>
        <span class="github-commit__message">{{ commit.message }}</span>
        <small class="github-meta">
          <a href="{{ commit.repoUrl }}" target="_blank" rel="noopener">{{ commit.repo }}</a>
        </small>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    {{ prose({ text: __("github.commits.none") }) }}
    {% endif %}

    <h2>{{ __("github.stars.title") }}</h2>
    {% if stars and stars.length > 0 %}
    <ul class="github-list github-list--grid">
      {% for star in stars %}
      <li class="github-list__item github-star">
        <a href="{{ star.url }}" class="github-star__name" target="_blank" rel="noopener">{{ star.name }}</a>
        {% if star.description %}
        <p class="github-star__desc">{{ star.description }}</p>
        {% endif %}
        <small class="github-meta">
          {% if star.language %}
          <span class="github-lang">{{ star.language }}</span>
          {% endif %}
          <span class="github-star__count">{{ star.stars }} stars</span>
        </small>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    {{ prose({ text: __("github.stars.none") }) }}
    {% endif %}

    {% if contributions and contributions.length > 0 %}
    <h2>{{ __("github.contributions.title") }}</h2>
    <ul class="github-list">
      {% for item in contributions %}
      <li class="github-list__item">
        {{ badge({
          color: "green" if item.type === "pr" else "blue",
          text: "PR" if item.type === "pr" else "Issue"
        }) }}
        <a href="{{ item.url }}" target="_blank" rel="noopener">{{ item.title }}</a>
        <small class="github-meta">
          <a href="{{ item.repoUrl }}" target="_blank" rel="noopener">{{ item.repo }}#{{ item.number }}</a>
        </small>
      </li>
      {% endfor %}
    </ul>
    {% endif %}

    <h2>{{ __("github.repos.title") }}</h2>
    {% if repositories and repositories.length > 0 %}
    <ul class="github-list github-list--grid">
      {% for repo in repositories %}
      <li class="github-list__item github-repo">
        <a href="{{ repo.url }}" class="github-repo__name" target="_blank" rel="noopener">
          {{ repo.name }}
          {% if repo.isPrivate %}
          {{ badge({ color: "gray", text: "Private" }) }}
          {% endif %}
          {% if repo.isFork %}
          {{ badge({ color: "purple", text: "Fork" }) }}
          {% endif %}
        </a>
        {% if repo.description %}
        <p class="github-repo__desc">{{ repo.description }}</p>
        {% endif %}
        <small class="github-meta">
          {% if repo.language %}
          <span class="github-lang">{{ repo.language }}</span>
          {% endif %}
          <span class="github-repo__stars">★ {{ repo.stars }}</span>
          {% if repo.forks > 0 %}
          <span class="github-repo__forks">⑂ {{ repo.forks }}</span>
          {% endif %}
        </small>
      </li>
      {% endfor %}
    </ul>
    {% else %}
    {{ prose({ text: __("github.repos.none") }) }}
    {% endif %}
  {% endif %}
{% endblock %}
